FROM {{ image_name|default("centos") }}
RUN curl https://bootstrap.pypa.io/get-pip.py | python
RUN pip install tox
RUN yum install -y http://rhos-release.virt.bos.redhat.com/repos/rhos-release/rhos-release-latest.noarch.rpm

{% if args['release'] != "master" %}
    RUN rhos-release {{ args['release'] }}
    RUN yum-config-manager --enable rhelosp-{{ args['release'] }}.0-unittest
{% endif %}

RUN yum install -y python-devel git gcc

{% if not args['local']|default(False) %}
    RUN git -c http.sslVerify=false clone {{ args['gerrit']|default(args['git']) }}/{{ args['project_name'] }}.git
{% else %}
    COPY . {{ args['project_path'] }}
    WORKDIR {{ args['project_path'] }}
{% endif %}

ENV TEST_ENV {{ args['tester'] }}

{% if args['release'] != "master" %}
    RUN git checkout rhos-{{ args['release'] }}.0-patches && tox -e $TEST_ENV
{% else %}
    RUN git checkout master && tox -e $TEST_ENV
{% endif %}
